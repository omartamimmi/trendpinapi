{
    "sourceFile": "Modules/User/app/Http/Controllers/AuthController.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 11,
            "patches": [
                {
                    "date": 1743122385333,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1759746607444,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -7,9 +7,10 @@\n use Modules\\User\\app\\Http\\Requests\\LoginRequest;\n \n class AuthController extends Controller\n {\n-    public function login(LoginRequest $request,  $authService)\n+\n+    public function login(LoginRequest $request, AuthService $authService)\n     {\n         try {\n             $authService\n                 ->setInputs($request->validated())\n@@ -25,5 +26,254 @@\n             Log::error($e->getMessage());\n             return $this->getErrorResponse($e->getMessage(), $e->getCode());\n         }\n     }\n+\n+    public function register(RegistrationRequest $request, AuthService $authService)\n+    {\n+        try {\n+            $authService\n+                ->setInputs($request->validated())\n+                ->setInput('contact_email',$request->input('email'))\n+                ->setInput('password',Hash::make($request->input('password')))\n+                ->persistUserBasicInfo()\n+                ->setInput('role', 'customer')\n+                ->assignRoleToUser()\n+                ->createUserLoginToken()\n+                ->collectOutput('data', $data);\n+\n+            return $this->getSuccessfulUserCreationResponse($data);\n+        } catch (Exception $e) {\n+            Log::error($e->getMessage());\n+            return $this->getErrorResponse($e->getMessage(), $e->getCode());\n+        }\n+    }\n+\n+    public function updateUserProfile(UpdateUserProfileRequest $request, AuthService $authService)\n+    {\n+        try {\n+            $authService\n+                ->setInputs($request->validated())\n+                ->setAuthUser(Auth::id())\n+                ->updateProfile()\n+                ->collectOutputs($user);\n+            return $this->getSuccessfulUserProfileUpdateResponse();\n+        } catch (Exception $e) {\n+            return $this->getErrorResponse($e->getMessage(), $e->getCode());\n+        }\n+    }\n+\n+    public function getUserProfile(UserProfileRequest $request, AuthService $authService)\n+    {\n+        try {\n+            $authService\n+                ->setInputs($request->validated())\n+                ->getUserData()\n+                ->collectOutputs($user);\n+            return $this->getSuccessfulUserProfileResponse($user);\n+        } catch (Exception $e) {\n+            return $this->getErrorResponse($e->getMessage(), $e->getCode());\n+        }\n+    }\n+\n+    public function logout(LogoutUserService $logoutUserService)\n+    {\n+        $logoutUserService\n+            ->setAuthUser(Auth::id())\n+            ->revokeToken();\n+        return $this->getSuccessfulResponse();\n+    }\n+\n+    public function saveToken(StoreUserFcmRequest $request, UserService $userService)\n+    {\n+        try {\n+            $userService\n+                ->setAuthUser(Auth::user())\n+                ->setInputs(getLocation())\n+                ->setInput('fcm_token', $request->validated('token'))\n+                ->saveFcmToken();\n+\n+            return response()->json(['token saved successfully.'])->setStatusCode(200);\n+        } catch (Exception $e) {\n+            return $this->getErrorResponse($e->getMessage(), $e->getCode());\n+        }\n+    }\n+\n+    public function sendNotificationBasedLocation(SendNotificationBasedLocation $request, NotificationService $notificationService)\n+    {\n+        try {\n+            $notificationService\n+            ->setInputs($request->validated())\n+            ->setInput('user', Auth::user())\n+            ->sendNotificationBasedLocation()\n+            ->collectOutput('notifications', $notifications);\n+            return response()->json(['notifications'=>$notifications])->setStatusCode(200);\n+\n+            // return response()->json(['message'=>'Notification sent successfully'])->setStatusCode(200);\n+        } catch (Exception $e) {\n+            return $this->getErrorResponse($e->getMessage(), $e->getCode());\n+        }\n+    }\n+\n+    public function getNotificationTest( NotificationService $notificationService)\n+    {\n+        try {\n+            $notifications = Notification::where('notifiable_id', Auth::id())->orderBy('created_at', 'desc')\n+            ->take(10)->get();\n+            return response()->json(['notifications'=>$notifications])->setStatusCode(200);\n+\n+            // return response()->json(['message'=>'Notification sent successfully'])->setStatusCode(200);\n+        } catch (Exception $e) {\n+            return $this->getErrorResponse($e->getMessage(), $e->getCode());\n+        }\n+    }\n+\n+    public function ChangeMyPassword(ChangePasswordRequest $request, AuthService $authService)\n+    {\n+        try{\n+            $authService\n+                ->setInputs($request->validated())\n+                ->setInput('authId', Auth::id())\n+                ->ChangeMyPassword();\n+            return response()->json(['message'=>'Password has been updated successfully'])->setStatusCode(200);\n+        } catch (Exception $e) {\n+            return $this->getErrorResponse($e->getMessage(), $e->getCode());\n+        }\n+    }\n+\n+    public function socialLoginMobile(SocialLoginMobile $request,AuthService $authService)\n+    {\n+        try {\n+            $authService\n+                ->setInputs($request->validated())\n+                ->setInput('password',Hash::make(123123123))\n+                ->persistUserBasicInfoForSocialLogin()\n+\n+                ->createUserLoginToken()\n+                ->collectOutput('data', $data);\n+\n+            return $this->getSuccessfulUserCreationResponse($data);\n+        } catch (Exception $e) {\n+            Log::error($e->getMessage());\n+            return $this->getErrorResponse($e->getMessage(), $e->getCode());\n+        }\n+    }\n+\n+    public function destroy(UserService $userService)\n+    {\n+        $user = Auth::user();\n+        $userService\n+            ->setInput('user',$user)\n+            ->deactivate();\n+        return response()->json(['message'=>'Your account has been deleted'], 200);\n+    }\n+\n+    public function sendNotification(SendNotificationBasedLocation $request, NotificationService $notificationService)\n+    {\n+        try{\n+            $notificationService\n+            ->setInput('user', Auth::user())\n+            ->setInput('fcm_token', $request->input('fcm_token'))\n+            ->sendNotification();   \n+            return response()->json(['message'=>'Notification sent successfully'])->setStatusCode(200);\n+        } catch (Exception $e) {\n+            return $this->getErrorResponse($e->getMessage(), $e->getCode());\n+        }\n+    }\n+\n+    private function getSuccessfulUserLoginResponse($data)\n+    {\n+        return (new AuthResource($data))->response()->setStatusCode(200);\n+    }\n+\n+    private function getErrorResponse($message, $statusCode)\n+    {\n+        $data = [\n+            'message' => $message,\n+            'code' => $statusCode,\n+        ];\n+        return (new ErrorResource($data))->response()->setStatusCode(403);\n+    }\n+\n+    private function getSuccessfulUserCreationResponse($user)\n+    {\n+        return (new UserResource($user))->response()->setStatusCode(201);\n+    }\n+\n+    private function getSuccessfulResponse()\n+    {\n+        return response()->json()->setStatusCode(204);\n+    }\n+\n+    private function getSuccessfulUserProfileResponse($user): JsonResponse\n+    {\n+        return (new UserProfileResource($user))->response()->setStatusCode(200);\n+    }\n+\n+    private function getSuccessfulUserProfileUpdateResponse(): JsonResponse\n+    {\n+        return response()->json()->setStatusCode(204);\n+    }\n+\n+    public function redirectToProvider($provider)\n+    {\n+        return Socialite::driver($provider)->stateless()->redirect();\n+    }\n+\n+\n+    public function handleProviderCallback($provider)\n+    {\n+        $user = Socialite::driver($provider)->user();\n+\n+        // Check if user already exists\n+        $existingUser = User::where('email', $user->getEmail())->first();\n+\n+        if ($existingUser) {\n+            // log the user in\n+            auth()->login($existingUser);\n+        } else {\n+            // create a new user account\n+            $newUser = new User();\n+            $newUser->name = $user->getName();\n+            $newUser->email = $user->getEmail();\n+            $newUser->password = Hash::make(Str::random(10));\n+            $newUser->save();\n+\n+            // log the user in\n+            auth()->login($newUser);\n+        }\n+        $existingUser->createToken('login-token', ['*'], Carbon::now()->addMonth());\n+        return redirect()->to('/home');\n+    }\n+\n+\n+    public function socialLogin(Request $request)\n+    {\n+        $provider = \"facebook\";\n+        $token = $request->input('access_token');\n+        $providerUser = Socialite::driver($provider)->userFromToken($token);\n+        $user = User::where('name', $providerUser->name)\n+            ->where('email', $providerUser->email ?? '')\n+            ->first();\n+\n+        if ($user == null) {\n+            $user = User::create([\n+                'name' => $providerUser->name,\n+                'email' => $providerUser->email ?? '',\n+                'password' => Hash::make($providerUser->password),\n+                'created_at' => $providerUser->created_at,\n+            ]);\n+\n+        }\n+        $user->createToken('login-token', ['*'], Carbon::now()->addMonth());\n+\n+        $userToken = $user->createToken($providerUser->token);\n+        // $user = Auth::loginUsingId($user->id);\n+\n+        $response = (object) [];\n+        $response->user = UserResource::make($user);\n+        $response->token = $userToken->token;\n+        return response()->json($response, 200);\n+\n+    }\n+\n }\n"
                },
                {
                    "date": 1759746639581,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -8,9 +8,9 @@\n \n class AuthController extends Controller\n {\n \n-    public function login(LoginRequest $request, AuthService $authService)\n+    public function login(LoginRequest $request, AuthServic $authService)\n     {\n         try {\n             $authService\n                 ->setInputs($request->validated())\n"
                },
                {
                    "date": 1759746655702,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -4,13 +4,38 @@\n \n use App\\Http\\Controllers\\Controller;\n use Illuminate\\Http\\Request;\n use Modules\\User\\app\\Http\\Requests\\LoginRequest;\n+use Modules\\User\\Services\\AuthService;\n+use Carbon\\Carbon;\n+use Illuminate\\Http\\JsonResponse;\n+use Illuminate\\Http\\Request;\n+use Illuminate\\Routing\\Controller;\n+use Illuminate\\Support\\Facades\\Log;\n+use Illuminate\\Support\\Facades\\Auth;\n+use Illuminate\\Support\\Facades\\Hash;\n+use Modules\\Notification\\Services\\NotificationService;\n+use Modules\\User\\Http\\Requests\\SendNotificationBasedLocation;\n+use Modules\\User\\Http\\Requests\\StoreUserFcmRequest;\n+use Modules\\User\\Services\\AuthService;\n+use Laravel\\Socialite\\Facades\\Socialite;\n+use Modules\\User\\Http\\Requests\\ChangePasswordRequest;\n+use Modules\\User\\Services\\UserService;\n+use Modules\\User\\Transformers\\AuthResource;\n+use Modules\\User\\Transformers\\UserResource;\n+use Modules\\User\\Http\\Requests\\LoginRequest;\n+use Modules\\User\\Services\\LogoutUserService;\n+use Modules\\User\\Transformers\\ErrorResource;\n+use Modules\\User\\Http\\Requests\\RegistrationRequest;\n+use Modules\\User\\Http\\Requests\\SocialLoginMobile;\n+use Modules\\User\\Http\\Requests\\UpdateUserProfileRequest;\n+use Modules\\User\\Http\\Requests\\UserProfileRequest;\n+use Modules\\User\\Transformers\\UserProfileResource;\n \n class AuthController extends Controller\n {\n \n-    public function login(LoginRequest $request, AuthServic $authService)\n+    public function login(LoginRequest $request, AuthService $authService)\n     {\n         try {\n             $authService\n                 ->setInputs($request->validated())\n"
                },
                {
                    "date": 1759746663089,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -15,9 +15,8 @@\n use Illuminate\\Support\\Facades\\Hash;\n use Modules\\Notification\\Services\\NotificationService;\n use Modules\\User\\Http\\Requests\\SendNotificationBasedLocation;\n use Modules\\User\\Http\\Requests\\StoreUserFcmRequest;\n-use Modules\\User\\Services\\AuthService;\n use Laravel\\Socialite\\Facades\\Socialite;\n use Modules\\User\\Http\\Requests\\ChangePasswordRequest;\n use Modules\\User\\Services\\UserService;\n use Modules\\User\\Transformers\\AuthResource;\n"
                },
                {
                    "date": 1759746668789,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -8,9 +8,8 @@\n use Modules\\User\\Services\\AuthService;\n use Carbon\\Carbon;\n use Illuminate\\Http\\JsonResponse;\n use Illuminate\\Http\\Request;\n-use Illuminate\\Routing\\Controller;\n use Illuminate\\Support\\Facades\\Log;\n use Illuminate\\Support\\Facades\\Auth;\n use Illuminate\\Support\\Facades\\Hash;\n use Modules\\Notification\\Services\\NotificationService;\n@@ -20,9 +19,8 @@\n use Modules\\User\\Http\\Requests\\ChangePasswordRequest;\n use Modules\\User\\Services\\UserService;\n use Modules\\User\\Transformers\\AuthResource;\n use Modules\\User\\Transformers\\UserResource;\n-use Modules\\User\\Http\\Requests\\LoginRequest;\n use Modules\\User\\Services\\LogoutUserService;\n use Modules\\User\\Transformers\\ErrorResource;\n use Modules\\User\\Http\\Requests\\RegistrationRequest;\n use Modules\\User\\Http\\Requests\\SocialLoginMobile;\n"
                },
                {
                    "date": 1759746677568,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -7,9 +7,8 @@\n use Modules\\User\\app\\Http\\Requests\\LoginRequest;\n use Modules\\User\\Services\\AuthService;\n use Carbon\\Carbon;\n use Illuminate\\Http\\JsonResponse;\n-use Illuminate\\Http\\Request;\n use Illuminate\\Support\\Facades\\Log;\n use Illuminate\\Support\\Facades\\Auth;\n use Illuminate\\Support\\Facades\\Hash;\n use Modules\\Notification\\Services\\NotificationService;\n@@ -26,8 +25,9 @@\n use Modules\\User\\Http\\Requests\\SocialLoginMobile;\n use Modules\\User\\Http\\Requests\\UpdateUserProfileRequest;\n use Modules\\User\\Http\\Requests\\UserProfileRequest;\n use Modules\\User\\Transformers\\UserProfileResource;\n+use Exception;\n \n class AuthController extends Controller\n {\n \n"
                },
                {
                    "date": 1759746688062,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -119,37 +119,9 @@\n             return $this->getErrorResponse($e->getMessage(), $e->getCode());\n         }\n     }\n \n-    public function sendNotificationBasedLocation(SendNotificationBasedLocation $request, NotificationService $notificationService)\n-    {\n-        try {\n-            $notificationService\n-            ->setInputs($request->validated())\n-            ->setInput('user', Auth::user())\n-            ->sendNotificationBasedLocation()\n-            ->collectOutput('notifications', $notifications);\n-            return response()->json(['notifications'=>$notifications])->setStatusCode(200);\n \n-            // return response()->json(['message'=>'Notification sent successfully'])->setStatusCode(200);\n-        } catch (Exception $e) {\n-            return $this->getErrorResponse($e->getMessage(), $e->getCode());\n-        }\n-    }\n-\n-    public function getNotificationTest( NotificationService $notificationService)\n-    {\n-        try {\n-            $notifications = Notification::where('notifiable_id', Auth::id())->orderBy('created_at', 'desc')\n-            ->take(10)->get();\n-            return response()->json(['notifications'=>$notifications])->setStatusCode(200);\n-\n-            // return response()->json(['message'=>'Notification sent successfully'])->setStatusCode(200);\n-        } catch (Exception $e) {\n-            return $this->getErrorResponse($e->getMessage(), $e->getCode());\n-        }\n-    }\n-\n     public function ChangeMyPassword(ChangePasswordRequest $request, AuthService $authService)\n     {\n         try{\n             $authService\n"
                },
                {
                    "date": 1759746974292,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,7 +1,7 @@\n <?php\n \n-namespace Modules\\User\\Http\\Controllers;\n+namespace Modules\\Category\\app\\Http\\Controllers;\n \n use App\\Http\\Controllers\\Controller;\n use Illuminate\\Http\\Request;\n use Modules\\User\\app\\Http\\Requests\\LoginRequest;\n"
                },
                {
                    "date": 1759747299340,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,274 @@\n+<?php\n+\n+namespace Modules\\User\\app\\Http\\Controllers;\n+\n+use App\\Http\\Controllers\\Controller;\n+use Illuminate\\Http\\Request;\n+use Modules\\User\\app\\Http\\Requests\\LoginRequest;\n+use Modules\\User\\Services\\AuthService;\n+use Carbon\\Carbon;\n+use Illuminate\\Http\\JsonResponse;\n+use Illuminate\\Support\\Facades\\Log;\n+use Illuminate\\Support\\Facades\\Auth;\n+use Illuminate\\Support\\Facades\\Hash;\n+use Modules\\Notification\\Services\\NotificationService;\n+use Modules\\User\\Http\\Requests\\SendNotificationBasedLocation;\n+use Modules\\User\\Http\\Requests\\StoreUserFcmRequest;\n+use Laravel\\Socialite\\Facades\\Socialite;\n+use Modules\\User\\Http\\Requests\\ChangePasswordRequest;\n+use Modules\\User\\Services\\UserService;\n+use Modules\\User\\Transformers\\AuthResource;\n+use Modules\\User\\Transformers\\UserResource;\n+use Modules\\User\\Services\\LogoutUserService;\n+use Modules\\User\\Transformers\\ErrorResource;\n+use Modules\\User\\Http\\Requests\\RegistrationRequest;\n+use Modules\\User\\Http\\Requests\\SocialLoginMobile;\n+use Modules\\User\\Http\\Requests\\UpdateUserProfileRequest;\n+use Modules\\User\\Http\\Requests\\UserProfileRequest;\n+use Modules\\User\\Transformers\\UserProfileResource;\n+use Exception;\n+namespace Modules\\User\\app\\Http\\Requests;\n+\n+class AuthController extends Controller\n+{\n+\n+    public function login(LoginRequest $request, AuthService $authService)\n+    {\n+        try {\n+            $authService\n+                ->setInputs($request->validated())\n+                ->attemptAuthentication()\n+                ->setAuthUser(Auth::id())\n+                ->checkIfUserBlocked()\n+                ->updateLastLogin()\n+                ->createUserLoginToken()\n+                ->collectOutput('data', $data);\n+            return $this->getSuccessfulUserLoginResponse($data);\n+\n+        } catch (Exception $e) {\n+            Log::error($e->getMessage());\n+            return $this->getErrorResponse($e->getMessage(), $e->getCode());\n+        }\n+    }\n+\n+    public function register(RegistrationRequest $request, AuthService $authService)\n+    {\n+        try {\n+            $authService\n+                ->setInputs($request->validated())\n+                ->setInput('contact_email',$request->input('email'))\n+                ->setInput('password',Hash::make($request->input('password')))\n+                ->persistUserBasicInfo()\n+                ->setInput('role', 'customer')\n+                ->assignRoleToUser()\n+                ->createUserLoginToken()\n+                ->collectOutput('data', $data);\n+\n+            return $this->getSuccessfulUserCreationResponse($data);\n+        } catch (Exception $e) {\n+            Log::error($e->getMessage());\n+            return $this->getErrorResponse($e->getMessage(), $e->getCode());\n+        }\n+    }\n+\n+    public function updateUserProfile(UpdateUserProfileRequest $request, AuthService $authService)\n+    {\n+        try {\n+            $authService\n+                ->setInputs($request->validated())\n+                ->setAuthUser(Auth::id())\n+                ->updateProfile()\n+                ->collectOutputs($user);\n+            return $this->getSuccessfulUserProfileUpdateResponse();\n+        } catch (Exception $e) {\n+            return $this->getErrorResponse($e->getMessage(), $e->getCode());\n+        }\n+    }\n+\n+    public function getUserProfile(UserProfileRequest $request, AuthService $authService)\n+    {\n+        try {\n+            $authService\n+                ->setInputs($request->validated())\n+                ->getUserData()\n+                ->collectOutputs($user);\n+            return $this->getSuccessfulUserProfileResponse($user);\n+        } catch (Exception $e) {\n+            return $this->getErrorResponse($e->getMessage(), $e->getCode());\n+        }\n+    }\n+\n+    public function logout(LogoutUserService $logoutUserService)\n+    {\n+        $logoutUserService\n+            ->setAuthUser(Auth::id())\n+            ->revokeToken();\n+        return $this->getSuccessfulResponse();\n+    }\n+\n+    public function saveToken(StoreUserFcmRequest $request, UserService $userService)\n+    {\n+        try {\n+            $userService\n+                ->setAuthUser(Auth::user())\n+                ->setInputs(getLocation())\n+                ->setInput('fcm_token', $request->validated('token'))\n+                ->saveFcmToken();\n+\n+            return response()->json(['token saved successfully.'])->setStatusCode(200);\n+        } catch (Exception $e) {\n+            return $this->getErrorResponse($e->getMessage(), $e->getCode());\n+        }\n+    }\n+\n+\n+    public function ChangeMyPassword(ChangePasswordRequest $request, AuthService $authService)\n+    {\n+        try{\n+            $authService\n+                ->setInputs($request->validated())\n+                ->setInput('authId', Auth::id())\n+                ->ChangeMyPassword();\n+            return response()->json(['message'=>'Password has been updated successfully'])->setStatusCode(200);\n+        } catch (Exception $e) {\n+            return $this->getErrorResponse($e->getMessage(), $e->getCode());\n+        }\n+    }\n+\n+    public function socialLoginMobile(SocialLoginMobile $request,AuthService $authService)\n+    {\n+        try {\n+            $authService\n+                ->setInputs($request->validated())\n+                ->setInput('password',Hash::make(123123123))\n+                ->persistUserBasicInfoForSocialLogin()\n+\n+                ->createUserLoginToken()\n+                ->collectOutput('data', $data);\n+\n+            return $this->getSuccessfulUserCreationResponse($data);\n+        } catch (Exception $e) {\n+            Log::error($e->getMessage());\n+            return $this->getErrorResponse($e->getMessage(), $e->getCode());\n+        }\n+    }\n+\n+    public function destroy(UserService $userService)\n+    {\n+        $user = Auth::user();\n+        $userService\n+            ->setInput('user',$user)\n+            ->deactivate();\n+        return response()->json(['message'=>'Your account has been deleted'], 200);\n+    }\n+\n+    public function sendNotification(SendNotificationBasedLocation $request, NotificationService $notificationService)\n+    {\n+        try{\n+            $notificationService\n+            ->setInput('user', Auth::user())\n+            ->setInput('fcm_token', $request->input('fcm_token'))\n+            ->sendNotification();   \n+            return response()->json(['message'=>'Notification sent successfully'])->setStatusCode(200);\n+        } catch (Exception $e) {\n+            return $this->getErrorResponse($e->getMessage(), $e->getCode());\n+        }\n+    }\n+\n+    private function getSuccessfulUserLoginResponse($data)\n+    {\n+        return (new AuthResource($data))->response()->setStatusCode(200);\n+    }\n+\n+    private function getErrorResponse($message, $statusCode)\n+    {\n+        $data = [\n+            'message' => $message,\n+            'code' => $statusCode,\n+        ];\n+        return (new ErrorResource($data))->response()->setStatusCode(403);\n+    }\n+\n+    private function getSuccessfulUserCreationResponse($user)\n+    {\n+        return (new UserResource($user))->response()->setStatusCode(201);\n+    }\n+\n+    private function getSuccessfulResponse()\n+    {\n+        return response()->json()->setStatusCode(204);\n+    }\n+\n+    private function getSuccessfulUserProfileResponse($user): JsonResponse\n+    {\n+        return (new UserProfileResource($user))->response()->setStatusCode(200);\n+    }\n+\n+    private function getSuccessfulUserProfileUpdateResponse(): JsonResponse\n+    {\n+        return response()->json()->setStatusCode(204);\n+    }\n+\n+    public function redirectToProvider($provider)\n+    {\n+        return Socialite::driver($provider)->stateless()->redirect();\n+    }\n+\n+\n+    public function handleProviderCallback($provider)\n+    {\n+        $user = Socialite::driver($provider)->user();\n+\n+        // Check if user already exists\n+        $existingUser = User::where('email', $user->getEmail())->first();\n+\n+        if ($existingUser) {\n+            // log the user in\n+            auth()->login($existingUser);\n+        } else {\n+            // create a new user account\n+            $newUser = new User();\n+            $newUser->name = $user->getName();\n+            $newUser->email = $user->getEmail();\n+            $newUser->password = Hash::make(Str::random(10));\n+            $newUser->save();\n+\n+            // log the user in\n+            auth()->login($newUser);\n+        }\n+        $existingUser->createToken('login-token', ['*'], Carbon::now()->addMonth());\n+        return redirect()->to('/home');\n+    }\n+\n+\n+    public function socialLogin(Request $request)\n+    {\n+        $provider = \"facebook\";\n+        $token = $request->input('access_token');\n+        $providerUser = Socialite::driver($provider)->userFromToken($token);\n+        $user = User::where('name', $providerUser->name)\n+            ->where('email', $providerUser->email ?? '')\n+            ->first();\n+\n+        if ($user == null) {\n+            $user = User::create([\n+                'name' => $providerUser->name,\n+                'email' => $providerUser->email ?? '',\n+                'password' => Hash::make($providerUser->password),\n+                'created_at' => $providerUser->created_at,\n+            ]);\n+\n+        }\n+        $user->createToken('login-token', ['*'], Carbon::now()->addMonth());\n+\n+        $userToken = $user->createToken($providerUser->token);\n+        // $user = Auth::loginUsingId($user->id);\n+\n+        $response = (object) [];\n+        $response->user = UserResource::make($user);\n+        $response->token = $userToken->token;\n+        return response()->json($response, 200);\n+\n+    }\n+\n+}\n"
                },
                {
                    "date": 1759747305528,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -26,9 +26,8 @@\n use Modules\\User\\Http\\Requests\\UpdateUserProfileRequest;\n use Modules\\User\\Http\\Requests\\UserProfileRequest;\n use Modules\\User\\Transformers\\UserProfileResource;\n use Exception;\n-namespace Modules\\User\\app\\Http\\Requests;\n \n class AuthController extends Controller\n {\n \n@@ -271,277 +270,4 @@\n \n     }\n \n }\n-<?php\n-\n-namespace Modules\\Category\\app\\Http\\Controllers;\n-\n-use App\\Http\\Controllers\\Controller;\n-use Illuminate\\Http\\Request;\n-use Modules\\User\\app\\Http\\Requests\\LoginRequest;\n-use Modules\\User\\Services\\AuthService;\n-use Carbon\\Carbon;\n-use Illuminate\\Http\\JsonResponse;\n-use Illuminate\\Support\\Facades\\Log;\n-use Illuminate\\Support\\Facades\\Auth;\n-use Illuminate\\Support\\Facades\\Hash;\n-use Modules\\Notification\\Services\\NotificationService;\n-use Modules\\User\\Http\\Requests\\SendNotificationBasedLocation;\n-use Modules\\User\\Http\\Requests\\StoreUserFcmRequest;\n-use Laravel\\Socialite\\Facades\\Socialite;\n-use Modules\\User\\Http\\Requests\\ChangePasswordRequest;\n-use Modules\\User\\Services\\UserService;\n-use Modules\\User\\Transformers\\AuthResource;\n-use Modules\\User\\Transformers\\UserResource;\n-use Modules\\User\\Services\\LogoutUserService;\n-use Modules\\User\\Transformers\\ErrorResource;\n-use Modules\\User\\Http\\Requests\\RegistrationRequest;\n-use Modules\\User\\Http\\Requests\\SocialLoginMobile;\n-use Modules\\User\\Http\\Requests\\UpdateUserProfileRequest;\n-use Modules\\User\\Http\\Requests\\UserProfileRequest;\n-use Modules\\User\\Transformers\\UserProfileResource;\n-use Exception;\n-\n-class AuthController extends Controller\n-{\n-\n-    public function login(LoginRequest $request, AuthService $authService)\n-    {\n-        try {\n-            $authService\n-                ->setInputs($request->validated())\n-                ->attemptAuthentication()\n-                ->setAuthUser(Auth::id())\n-                ->checkIfUserBlocked()\n-                ->updateLastLogin()\n-                ->createUserLoginToken()\n-                ->collectOutput('data', $data);\n-            return $this->getSuccessfulUserLoginResponse($data);\n-\n-        } catch (Exception $e) {\n-            Log::error($e->getMessage());\n-            return $this->getErrorResponse($e->getMessage(), $e->getCode());\n-        }\n-    }\n-\n-    public function register(RegistrationRequest $request, AuthService $authService)\n-    {\n-        try {\n-            $authService\n-                ->setInputs($request->validated())\n-                ->setInput('contact_email',$request->input('email'))\n-                ->setInput('password',Hash::make($request->input('password')))\n-                ->persistUserBasicInfo()\n-                ->setInput('role', 'customer')\n-                ->assignRoleToUser()\n-                ->createUserLoginToken()\n-                ->collectOutput('data', $data);\n-\n-            return $this->getSuccessfulUserCreationResponse($data);\n-        } catch (Exception $e) {\n-            Log::error($e->getMessage());\n-            return $this->getErrorResponse($e->getMessage(), $e->getCode());\n-        }\n-    }\n-\n-    public function updateUserProfile(UpdateUserProfileRequest $request, AuthService $authService)\n-    {\n-        try {\n-            $authService\n-                ->setInputs($request->validated())\n-                ->setAuthUser(Auth::id())\n-                ->updateProfile()\n-                ->collectOutputs($user);\n-            return $this->getSuccessfulUserProfileUpdateResponse();\n-        } catch (Exception $e) {\n-            return $this->getErrorResponse($e->getMessage(), $e->getCode());\n-        }\n-    }\n-\n-    public function getUserProfile(UserProfileRequest $request, AuthService $authService)\n-    {\n-        try {\n-            $authService\n-                ->setInputs($request->validated())\n-                ->getUserData()\n-                ->collectOutputs($user);\n-            return $this->getSuccessfulUserProfileResponse($user);\n-        } catch (Exception $e) {\n-            return $this->getErrorResponse($e->getMessage(), $e->getCode());\n-        }\n-    }\n-\n-    public function logout(LogoutUserService $logoutUserService)\n-    {\n-        $logoutUserService\n-            ->setAuthUser(Auth::id())\n-            ->revokeToken();\n-        return $this->getSuccessfulResponse();\n-    }\n-\n-    public function saveToken(StoreUserFcmRequest $request, UserService $userService)\n-    {\n-        try {\n-            $userService\n-                ->setAuthUser(Auth::user())\n-                ->setInputs(getLocation())\n-                ->setInput('fcm_token', $request->validated('token'))\n-                ->saveFcmToken();\n-\n-            return response()->json(['token saved successfully.'])->setStatusCode(200);\n-        } catch (Exception $e) {\n-            return $this->getErrorResponse($e->getMessage(), $e->getCode());\n-        }\n-    }\n-\n-\n-    public function ChangeMyPassword(ChangePasswordRequest $request, AuthService $authService)\n-    {\n-        try{\n-            $authService\n-                ->setInputs($request->validated())\n-                ->setInput('authId', Auth::id())\n-                ->ChangeMyPassword();\n-            return response()->json(['message'=>'Password has been updated successfully'])->setStatusCode(200);\n-        } catch (Exception $e) {\n-            return $this->getErrorResponse($e->getMessage(), $e->getCode());\n-        }\n-    }\n-\n-    public function socialLoginMobile(SocialLoginMobile $request,AuthService $authService)\n-    {\n-        try {\n-            $authService\n-                ->setInputs($request->validated())\n-                ->setInput('password',Hash::make(123123123))\n-                ->persistUserBasicInfoForSocialLogin()\n-\n-                ->createUserLoginToken()\n-                ->collectOutput('data', $data);\n-\n-            return $this->getSuccessfulUserCreationResponse($data);\n-        } catch (Exception $e) {\n-            Log::error($e->getMessage());\n-            return $this->getErrorResponse($e->getMessage(), $e->getCode());\n-        }\n-    }\n-\n-    public function destroy(UserService $userService)\n-    {\n-        $user = Auth::user();\n-        $userService\n-            ->setInput('user',$user)\n-            ->deactivate();\n-        return response()->json(['message'=>'Your account has been deleted'], 200);\n-    }\n-\n-    public function sendNotification(SendNotificationBasedLocation $request, NotificationService $notificationService)\n-    {\n-        try{\n-            $notificationService\n-            ->setInput('user', Auth::user())\n-            ->setInput('fcm_token', $request->input('fcm_token'))\n-            ->sendNotification();   \n-            return response()->json(['message'=>'Notification sent successfully'])->setStatusCode(200);\n-        } catch (Exception $e) {\n-            return $this->getErrorResponse($e->getMessage(), $e->getCode());\n-        }\n-    }\n-\n-    private function getSuccessfulUserLoginResponse($data)\n-    {\n-        return (new AuthResource($data))->response()->setStatusCode(200);\n-    }\n-\n-    private function getErrorResponse($message, $statusCode)\n-    {\n-        $data = [\n-            'message' => $message,\n-            'code' => $statusCode,\n-        ];\n-        return (new ErrorResource($data))->response()->setStatusCode(403);\n-    }\n-\n-    private function getSuccessfulUserCreationResponse($user)\n-    {\n-        return (new UserResource($user))->response()->setStatusCode(201);\n-    }\n-\n-    private function getSuccessfulResponse()\n-    {\n-        return response()->json()->setStatusCode(204);\n-    }\n-\n-    private function getSuccessfulUserProfileResponse($user): JsonResponse\n-    {\n-        return (new UserProfileResource($user))->response()->setStatusCode(200);\n-    }\n-\n-    private function getSuccessfulUserProfileUpdateResponse(): JsonResponse\n-    {\n-        return response()->json()->setStatusCode(204);\n-    }\n-\n-    public function redirectToProvider($provider)\n-    {\n-        return Socialite::driver($provider)->stateless()->redirect();\n-    }\n-\n-\n-    public function handleProviderCallback($provider)\n-    {\n-        $user = Socialite::driver($provider)->user();\n-\n-        // Check if user already exists\n-        $existingUser = User::where('email', $user->getEmail())->first();\n-\n-        if ($existingUser) {\n-            // log the user in\n-            auth()->login($existingUser);\n-        } else {\n-            // create a new user account\n-            $newUser = new User();\n-            $newUser->name = $user->getName();\n-            $newUser->email = $user->getEmail();\n-            $newUser->password = Hash::make(Str::random(10));\n-            $newUser->save();\n-\n-            // log the user in\n-            auth()->login($newUser);\n-        }\n-        $existingUser->createToken('login-token', ['*'], Carbon::now()->addMonth());\n-        return redirect()->to('/home');\n-    }\n-\n-\n-    public function socialLogin(Request $request)\n-    {\n-        $provider = \"facebook\";\n-        $token = $request->input('access_token');\n-        $providerUser = Socialite::driver($provider)->userFromToken($token);\n-        $user = User::where('name', $providerUser->name)\n-            ->where('email', $providerUser->email ?? '')\n-            ->first();\n-\n-        if ($user == null) {\n-            $user = User::create([\n-                'name' => $providerUser->name,\n-                'email' => $providerUser->email ?? '',\n-                'password' => Hash::make($providerUser->password),\n-                'created_at' => $providerUser->created_at,\n-            ]);\n-\n-        }\n-        $user->createToken('login-token', ['*'], Carbon::now()->addMonth());\n-\n-        $userToken = $user->createToken($providerUser->token);\n-        // $user = Auth::loginUsingId($user->id);\n-\n-        $response = (object) [];\n-        $response->user = UserResource::make($user);\n-        $response->token = $userToken->token;\n-        return response()->json($response, 200);\n-\n-    }\n-\n-}\n"
                },
                {
                    "date": 1759747313917,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -11,21 +11,21 @@\n use Illuminate\\Support\\Facades\\Log;\n use Illuminate\\Support\\Facades\\Auth;\n use Illuminate\\Support\\Facades\\Hash;\n use Modules\\Notification\\Services\\NotificationService;\n-use Modules\\User\\Http\\Requests\\SendNotificationBasedLocation;\n-use Modules\\User\\Http\\Requests\\StoreUserFcmRequest;\n+use Modules\\User\\app\\Http\\Requests\\SendNotificationBasedLocation;\n+use Modules\\User\\app\\Http\\Requests\\StoreUserFcmRequest;\n use Laravel\\Socialite\\Facades\\Socialite;\n-use Modules\\User\\Http\\Requests\\ChangePasswordRequest;\n+use Modules\\User\\app\\Http\\Requests\\ChangePasswordRequest;\n use Modules\\User\\Services\\UserService;\n use Modules\\User\\Transformers\\AuthResource;\n use Modules\\User\\Transformers\\UserResource;\n use Modules\\User\\Services\\LogoutUserService;\n use Modules\\User\\Transformers\\ErrorResource;\n-use Modules\\User\\Http\\Requests\\RegistrationRequest;\n-use Modules\\User\\Http\\Requests\\SocialLoginMobile;\n-use Modules\\User\\Http\\Requests\\UpdateUserProfileRequest;\n-use Modules\\User\\Http\\Requests\\UserProfileRequest;\n+use Modules\\User\\app\\Http\\Requests\\RegistrationRequest;\n+use Modules\\User\\app\\Http\\Requests\\SocialLoginMobile;\n+use Modules\\User\\app\\Http\\Requests\\UpdateUserProfileRequest;\n+use Modules\\User\\app\\Http\\Requests\\UserProfileRequest;\n use Modules\\User\\Transformers\\UserProfileResource;\n use Exception;\n \n class AuthController extends Controller\n"
                }
            ],
            "date": 1743122385333,
            "name": "Commit-0",
            "content": "<?php\n\nnamespace Modules\\User\\Http\\Controllers;\n\nuse App\\Http\\Controllers\\Controller;\nuse Illuminate\\Http\\Request;\nuse Modules\\User\\app\\Http\\Requests\\LoginRequest;\n\nclass AuthController extends Controller\n{\n    public function login(LoginRequest $request,  $authService)\n    {\n        try {\n            $authService\n                ->setInputs($request->validated())\n                ->attemptAuthentication()\n                ->setAuthUser(Auth::id())\n                ->checkIfUserBlocked()\n                ->updateLastLogin()\n                ->createUserLoginToken()\n                ->collectOutput('data', $data);\n            return $this->getSuccessfulUserLoginResponse($data);\n\n        } catch (Exception $e) {\n            Log::error($e->getMessage());\n            return $this->getErrorResponse($e->getMessage(), $e->getCode());\n        }\n    }\n}\n"
        }
    ]
}