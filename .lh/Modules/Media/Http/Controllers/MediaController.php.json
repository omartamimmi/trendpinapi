{
    "sourceFile": "Modules/Media/Http/Controllers/MediaController.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1760283080705,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1760283080705,
            "name": "Commit-0",
            "content": "<?php\n\nnamespace Modules\\Media\\Http\\Controllers;\n\nuse Illuminate\\Contracts\\Support\\Renderable;\nuse Illuminate\\Routing\\Controller;\nuse Illuminate\\Support\\Facades\\Auth;\nuse Illuminate\\Support\\Facades\\Storage;\nuse Illuminate\\Support\\Str;\nuse Modules\\Media\\Helpers\\FileHelper;\nuse Modules\\Media\\Models\\MediaFile;\nuse Intervention\\Image\\ImageManager as Image;\nuse ImageOptimizer;\nuse Modules\\Media\\Http\\Requests\\MediaRequest;\nuse Modules\\Media\\Services\\MediaService;\nuse Modules\\User\\Transformers\\ErrorResource;\nuse Throwable;\nuse Illuminate\\Http\\JsonResponse;\nuse Illuminate\\Http\\Request;\nuse Modules\\Media\\Http\\Requests\\AllMediaRequest;\n\nclass MediaController extends Controller\n{\n    /**\n     * Store media files\n     *\n     * @authenticated as user\n     *\n     * @group Media\n     *\n     * @response\n        \"data\": {\n           \"message\": \"File uploaded successfully\"\n        }\n     */\n    public function store(MediaRequest $request, MediaService $mediaService)\n    {\n        try{\n            $mediaService\n            ->setInputs($request->validated())\n            ->folderGenerate(Auth::id())\n            ->storeFile()\n            ->prepareFileData()\n            ->imageOptimizer()\n            ->saveFile()\n            ->collectOutputs($media);\n            // dd($media);\n            return $this->getSuccessfulUserResponse($media);\n        }catch(Throwable $e){\n            return $this->getErrorResponse($e->getMessage(), 400);\n        }\n    }\n\n\n    /**\n     * get all media files\n     *\n     * @authenticated as user\n     *\n     * @group Media\n     *\n     * @response\n        \"data\": {\n           \"media\": []\n        }\n     */\n    public function allMedia(MediaService $mediaService)\n    {\n        try{\n            $mediaService\n            ->getAllMediaByAuthor()\n            ->collectOutputs($media);\n            return response()->json($media)->setStatusCode(200);\n        }catch(Throwable $e){\n            return $this->getErrorResponse($e->getMessage(), 400);\n        }\n    }\n\n    /**\n     * delete media files\n     *\n     * @authenticated as user\n     *\n     * @group Media\n     *\n     * @response\n        \"data\": {\n           \"message\": \"File uploaded successfully\"\n        }\n     */\n    public function delete(AllMediaRequest $request, MediaService $mediaService)\n    {\n        try{\n            $mediaService\n            ->setInputs($request->validated())\n            ->delete();\n\n            return $this->getSuccessfulUserResponse('Files deleted successfully');\n        }catch(Throwable $e){\n            return $this->getErrorResponse($e->getMessage(), 400);\n        }\n    }\n\n    /**\n     * get all media files\n     *\n     * @authenticated as user\n     *\n     * @group Media\n     *\n     * @response\n        \"data\": {\n        }\n     */\n    public function getImage(Request $request, MediaService $mediaService)\n    {\n        try{\n            $mediaService\n                ->setInput('id', $request->get('id'))\n                ->getImage()\n                ->collectOutput('media', $media);\n            return response()->json(['data' => $media])->setStatusCode(200);\n        }catch(Throwable $e){\n            return $this->getErrorResponse($e->getMessage(), 400);\n        }\n    }\n\n    private function getErrorResponse($message, $statusCode): JsonResponse\n    {\n        $data = [\n            'message' => $message,\n            'code' => $statusCode,\n        ];\n        return (new ErrorResource($data))->response()->setStatusCode($statusCode);\n    }\n\n\n    private function getSuccessfulUserResponse($data): JsonResponse\n    {\n        return response()->json($data)->setStatusCode(200);\n    }\n}\n"
        }
    ]
}