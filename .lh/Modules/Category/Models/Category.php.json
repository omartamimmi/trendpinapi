{
    "sourceFile": "Modules/Category/Models/Category.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1760282031575,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1760282031575,
            "name": "Commit-0",
            "content": "<?php\n\nnamespace Modules\\Category\\Models;\n\nuse Illuminate\\Database\\Eloquent\\Model;\nuse Illuminate\\Support\\Facades\\Auth;\nuse Illuminate\\Support\\Str;\nuse Modules\\Media\\Helpers\\FileHelper;\n\nclass Category extends Model\n{\n    /**\n     * The attributes that are mass assignable.\n     *\n     * @var array<int, string>\n     */\n    protected $fillable = [\n        'name',\n        'description',\n        'status',\n        'publish_date',\n        'create_user',\n        'update_user',\n        'image_id',\n        'featured_image',\n        'name_ar',\n        'description_ar'\n    ];\n\n    protected $slugField     = 'slug';\n    protected $slugFromField = 'name';\n\n\n    public function save(array $options = [])\n    {\n        $this->featured_image = $this->getFeaturedImage()[0]['featured_mobile'];\n\n        if ($this->create_user) {\n            $this->update_user = Auth::id();\n        } else {\n            $this->create_user = Auth::id();\n        }\n        if ($this->slugField && $this->slugFromField) {\n            $slugField = $this->slugField;\n            $this->$slugField = $this->generateSlug($this->$slugField);\n        }\n        return parent::save($options); // TODO: Change the autogenerated stub\n    }\n\n    public function getFeaturedImage()\n    {\n        if (empty($this->image_id))\n            return $this->image_id;\n        $list_item = [];\n        if ($this->image_id) {\n            $list_item[] = [\n                'featured_mobile' => FileHelper::url($this->image_id, 'cat_image'),\n                'featured_web' => FileHelper::url($this->image_id, 'thumb'),\n\n            ];\n        }\n        return $list_item;\n    }\n\n    public function generateSlug($string = false, $count = 0)\n    {\n        $slugFromField = $this->slugFromField;\n        if (empty($string))\n            $string = $this->$slugFromField;\n        $slug = $newSlug = $this->strToSlug($string);\n        $newSlug = $slug . ($count ? '-' . $count : '');\n        $model = static::select('count(id)');\n        if ($this->id) {\n            $model->where('id', '<>', $this->id);\n        }\n        $check = $model->where($this->slugField, $newSlug)->count();\n        if (!empty($check)) {\n            return $this->generateSlug($slug, $count + 1);\n        }\n        return $newSlug;\n    }\n\n    // Add Support for non-ascii string\n    // Example বাংলাদেশ   ব্যাংকের    রিজার্ভের  অর্থ  চুরির   ঘটনায়   ফিলিপাইনের\n    protected function strToSlug($string) {\n        $slug = Str::slug($string);\n        if(empty($slug)){\n            $slug = preg_replace('/\\s+/u', '-', trim($string));\n        }\n        return $slug;\n    }\n\n}\n"
        }
    ]
}